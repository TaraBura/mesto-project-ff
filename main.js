(()=>{"use strict";const e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-22",headers:{authorization:"dd1dbf2c-5beb-4ecd-b2da-38506ca41c18","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}function r(e,t,r,o,c){const s=t.querySelector(".card");if(!s)return console.error("Элемент с классом .card не найден в шаблоне."),null;const a=s.cloneNode(!0),l=a.querySelector(".card__delete-button"),i=a.querySelector(".card__like-button"),u=a.querySelector(".card__image"),d=a.querySelector(".card__title"),p=a.querySelector(".like__counter");return u?(u.src=e.link,u.alt=e.name,u.addEventListener("click",(()=>r(e.link,e.name)))):console.error("Элемент с классом .card__image не найден в карточке."),d?d.textContent=e.name:console.error("Элемент с классом .card__title не найден в карточке."),p?p.textContent=e.likes.length:console.error("Элемент с классом .like__counter не найден в карточке."),i?(i.dataset.id=e._id,i.addEventListener("click",n),e.likes.some((e=>e._id===o))&&i.classList.add("card__like-button_is-active")):console.error("Элемент с классом .card__like-button не найден в карточке."),l?(e.owner._id!==o&&l.classList.add("card__delete-button--hidden"),e.owner._id===o&&l.addEventListener("click",(()=>c(e._id,a)))):console.error("Элемент с классом .card__delete-button не найден в карточке."),a}function n(r){const n=r.target,o=n.dataset.id,c=n.nextElementSibling;var s;c?n.classList.contains("card__like-button_is-active")?(s=o,fetch(`${e.baseUrl}/cards/likes/${s}`,{method:"DELETE",headers:e.headers}).then((e=>t(e)))).then((e=>{c.textContent=e.likes.length,n.classList.remove("card__like-button_is-active")})).catch((e=>console.error("Ошибка при удалении лайка:",e))):function(r){return fetch(`${e.baseUrl}/cards/likes/${r}`,{method:"PUT",headers:e.headers}).then((e=>t(e)))}(o).then((e=>{c.textContent=e.likes.length,n.classList.add("card__like-button_is-active")})).catch((e=>console.error("Ошибка при добавлении лайка:",e))):console.error("Элемент счётчика лайков не найден рядом с кнопкой лайка.")}function o(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",a),e.addEventListener("click",s)}function c(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a),e.removeEventListener("click",s)}function s(e){e.currentTarget===e.target&&c(e.currentTarget)}function a(e){if("Escape"===e.key){const e=document.querySelector(".popup_is-opened");e&&c(e)}}function l(e,t){const r=Array.from(e.querySelectorAll(t.inputList)),n=e.querySelector(t.buttonElement);r.forEach((r=>{i(e,r,t)})),u(r,n,t)}const i=(e,t,r)=>{const n=e.querySelector(`.${t.id}-error`);t.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass),n.textContent="",t.setCustomValidity("")},u=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?(t.disabled=!0,t.classList.add(r.buttonElementDisabled)):(t.disabled=!1,t.classList.remove(r.buttonElementDisabled))};function d(e,t,r="Сохранение...",n="Сохранить"){t.textContent=e?r:n}const p=document.querySelector("#card-template").content,_=document.querySelector(".places__list"),m=document.querySelector(".popup_type_image"),y=m.querySelector(".popup__close"),h=m.querySelector(".popup__image"),v=m.querySelector(".popup__caption"),f=document.querySelector(".popup_type_new-card"),b=f.querySelector(".popup__close"),E=document.querySelector(".profile__add-button"),S=document.querySelector(".popup_type_question"),L=S.querySelector(".popup__close"),q=document.querySelector(".popup_type_edit"),k=q.querySelector(".popup__close"),C=document.querySelector(".profile__edit-button"),g=document.querySelector(".popup_type_new-avatar"),$=g.querySelector(".popup__close"),x=document.querySelector(".profile__image"),D=document.querySelector(".profile__title"),U=document.querySelector(".profile__description"),w=document.forms["edit-profile"],T=document.forms["new-place"],A=document.forms["avatar-edit"],P=w.elements.name,I=w.elements.description,N=T.elements["place-name"],O=document.getElementById("new-place-url-input"),j=document.getElementById("avatar-url-input"),J=q.querySelector(".popup__button"),M=g.querySelector(".popup__button"),V=T.querySelector(".popup__button"),B=S.querySelector(".popup__button-question");let H,z=null,F=null;const G={formList:".popup__form",inputList:".popup__input",buttonElement:".popup__button",buttonElementDisabled:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function K(e,t){h.src=e,h.alt=t,v.textContent=t,o(m)}function Q(e,t){z=e,F=t,o(S)}function R(){c(S),z=null,F=null}C.addEventListener("click",(()=>{P.value=D.textContent,I.value=U.textContent,l(q,G),o(q)})),w.addEventListener("submit",(function(r){r.preventDefault();const n=P.value.trim(),o=I.value.trim();var s,a;d(!0,J),(s=n,a=o,fetch(`${e.baseUrl}/users/me`,{method:"PATCH",headers:e.headers,body:JSON.stringify({name:s,about:a})}).then((e=>t(e)))).then((e=>{D.textContent=e.name,U.textContent=e.about,c(q)})).catch((e=>{console.error("Ошибка при обновлении профиля:",e)})).finally((()=>{d(!1,J)}))})),k.addEventListener("click",(()=>{w.reset(),c(q)})),E.addEventListener("click",(()=>{o(f)})),T.addEventListener("submit",(function(n){n.preventDefault();const o=N.value.trim(),s=O.value.trim();d(!0,V),function(r,n){return fetch(`${e.baseUrl}/cards`,{method:"POST",headers:e.headers,body:JSON.stringify({name:r,link:n})}).then((e=>t(e)))}(o,s).then((e=>{const t=r(e,p,K,H,Q);_.prepend(t),T.reset(),l(f,G),c(f)})).catch((e=>{console.error("Ошибка при добавлении карточки:",e)})).finally((()=>{d(!1,V)}))})),b.addEventListener("click",(()=>{T.reset(),l(f,G),c(f)})),x.addEventListener("click",(()=>{o(g)})),A.addEventListener("submit",(function(r){r.preventDefault();const n=j.value.trim();var o;d(!0,M),(o=n,fetch(`${e.baseUrl}/users/me/avatar`,{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then((e=>t(e)))).then((e=>{x.style.backgroundImage=`url('${e.avatar}')`,A.reset(),l(A,G),c(g)})).catch((e=>{console.error("Ошибка при обновлении аватара:",e)})).finally((()=>{d(!1,M)}))})),$.addEventListener("click",(()=>{c(g),l(A,G),A.reset()})),y.addEventListener("click",(()=>{c(m)})),B.addEventListener("click",(function(r){var n;r.preventDefault(),z&&F?(d(!0,B,"Удаление...","Да"),(n=z,fetch(`${e.baseUrl}/cards/${n}`,{method:"DELETE",headers:e.headers}).then((e=>t(e)))).then((()=>{F.remove(),R()})).catch((e=>{console.error("Ошибка при удалении карточки:",e)})).finally((()=>{d(!1,B,"Удаление...","Да"),z=null,F=null}))):console.error("Нет информации о карточке для удаления.")})),L.addEventListener("click",(()=>{R()})),(e=>{Array.from(document.querySelectorAll(e.formList)).forEach((t=>{t.addEventListener("submit",(e=>{e.preventDefault()})),((e,t)=>{const r=Array.from(e.querySelectorAll(t.inputList)),n=e.querySelector(t.buttonElement);u(r,n,t),r.forEach((o=>{o.addEventListener("input",(function(){((e,t,r)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?i(e,t,r):((e,t,r,n)=>{const o=e.querySelector(`.${t.id}-error`);t.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass)})(e,t,t.validationMessage,r)})(e,o,t),u(r,n,t)}))}))})(t,e)}))})(G),Promise.all([fetch(`${e.baseUrl}/users/me`,{headers:e.headers}).then((e=>t(e))),fetch(`${e.baseUrl}/cards`,{headers:e.headers}).then((e=>t(e)))]).then((([e,t])=>{H=e._id,x.style.backgroundImage=`url(${e.avatar})`,D.textContent=e.name,U.textContent=e.about;const n=document.createDocumentFragment();t.forEach((e=>{const t=r(e,p,K,H,Q);n.appendChild(t)})),_.appendChild(n)})).catch((e=>console.error("Ошибка при загрузке данных:",e)))})();